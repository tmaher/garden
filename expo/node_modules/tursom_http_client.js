var https = require('https');
var http = require('http');

var get = function(user_options, user_cb){
    var uc = /^(?:(http(?:s)):\/\/){0,1}([a-z0-9_\.-]+)(?::([0-9]{1,5})){0,1}(\/[a-z0-9\/\?\&=;:!_@$%\'\.\-\*\+\(\)]*){0,1}/i(user_options["url"]);

    var o = user_options;
    proto = (uc[1] == null) ? "http" : uc[1];
    o['host'] = uc[2];
    o['port'] = (uc[3] == null) ? (proto == "https" ? 443 : 80) : uc[3];
    o['path'] = (uc[4] == null) ? "/" : uc[4];

    var handler = (proto == "http") ? http : https;

    // console.log(JSON.stringify(o, null, "  "));

    var req = handler.get(o, function(res){
        res.data = "";
        res.on("data", function(c){ res.data += c; });
        var fin = function(){
            if(typeof(user_cb) == "function")
                user_cb(res);
        };
        res.on("end", fin);
        res.on("close", fin);
    });
    return req;
}

exports.get = get;
